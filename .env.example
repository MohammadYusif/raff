# ============================================
# DATABASE
# ============================================
# PostgreSQL connection string.
# Local (Docker): postgresql://postgres:postgres@localhost:5432/raff
# Railway: Provided automatically via Railway's PostgreSQL add-on.
DATABASE_URL="postgresql://USER:PASSWORD@HOST:5432/DATABASE_NAME"

# ============================================
# NEXTAUTH
# ============================================
# A random 32+ character secret used to sign JWT tokens.
# Generate one with: openssl rand -base64 32
NEXTAUTH_SECRET="your-random-secret-here"

# The canonical URL of your application (used for OAuth callbacks).
# Local development: http://localhost:3000
NEXTAUTH_URL="https://your-domain.com"

# ============================================
# APP CONFIGURATION
# ============================================
# Public-facing URL used in emails, social links, and client-side redirects.
NEXT_PUBLIC_APP_URL="https://your-domain.com"
NEXT_PUBLIC_APP_NAME="Raff"

# ============================================
# SALLA INTEGRATION
# https://salla.dev — Create an app to get credentials.
# ============================================

# OAuth Configuration
SALLA_AUTH_URL="https://accounts.salla.sa/oauth2/authorize"
SALLA_TOKEN_URL="https://accounts.salla.sa/oauth2/token"
SALLA_API_BASE_URL="https://api.salla.dev/admin/v2"
SALLA_CLIENT_ID=""                  # From your Salla app dashboard
SALLA_CLIENT_SECRET=""              # From your Salla app dashboard
SALLA_APP_BASE_URL="https://your-domain.com"
SALLA_REDIRECT_URI="https://your-domain.com/api/salla/oauth"
SALLA_SCOPES="offline_access products.read orders.read webhooks.read webhooks.write"

# App ID — Found in the URL when viewing your app on salla.dev (e.g., salla.dev/apps/YOUR_APP_ID).
SALLA_APP_ID=""

# Webhooks
# The webhook secret is set in your Salla app's webhook configuration page.
SALLA_WEBHOOK_SECRET=""
SALLA_WEBHOOK_HEADER="x-salla-signature"
SALLA_WEBHOOK_VERSION="2"
SALLA_WEBHOOK_CREATE_URL="https://api.salla.dev/admin/v2/webhooks/subscribe"
SALLA_WEBHOOK_CALLBACK_URL="https://your-domain.com/api/salla/webhook"
SALLA_WEBHOOK_EVENTS="product.created,product.updated,product.deleted,order.created,order.updated,order.status.updated,order.cancelled,order.refunded,app.subscription.started,app.subscription.renewed,app.subscription.canceled,app.subscription.expired"
# Signature verification mode: "hmac-sha256" (recommended), "sha256", or "plain"
SALLA_WEBHOOK_SIGNATURE_MODE="hmac-sha256"

# Product API URLs (defaults — override only if Salla changes their API)
SALLA_PRODUCTS_API_URL="https://api.salla.dev/admin/v2/products"
SALLA_PRODUCT_API_URL_TEMPLATE="https://api.salla.dev/admin/v2/products/{id}"
SALLA_CATEGORIES_API_URL="https://api.salla.dev/admin/v2/categories"
SALLA_PRODUCT_URL_TEMPLATE="https://{store_url}/product/{product_id}"

# ============================================
# ZID INTEGRATION
# https://web.zid.sa — Create a developer app to get credentials.
# ============================================

# OAuth Configuration
ZID_AUTH_URL="https://oauth.zid.sa/oauth/authorize"
ZID_TOKEN_URL="https://oauth.zid.sa/oauth/token"
ZID_API_BASE_URL="https://api.zid.sa/v1"
ZID_CLIENT_ID=""                    # From your Zid developer dashboard
ZID_CLIENT_SECRET=""                # From your Zid developer dashboard
ZID_APP_BASE_URL="https://your-domain.com"
ZID_REDIRECT_URI="https://your-domain.com/api/zid/oauth/callback"
ZID_SCOPES="products.read categories.read orders.read abandoned_carts.read webhooks.read webhooks.write"

# App ID — Required for subscription status checks via the Zid API.
ZID_APP_ID=""

# Webhooks
ZID_WEBHOOK_SECRET=""
ZID_WEBHOOK_HEADER="X-Zid-Webhook-Secret"
ZID_WEBHOOK_CREATE_URL="https://api.zid.sa/v1/managers/webhooks"
ZID_WEBHOOK_CALLBACK_URL="https://your-domain.com/api/zid/webhook"
ZID_WEBHOOK_EVENTS="product.create,product.update,product.publish,product.delete,order.create,order.status.update,order.payment_status.update"
# Signature verification mode: "plain", "sha256", or "hmac-sha256"
ZID_WEBHOOK_SIGNATURE_MODE="plain"
# Optional token appended as a query parameter for webhook verification.
ZID_WEBHOOK_TOKEN=""

# Product URLs
ZID_PRODUCT_URL_TEMPLATE="https://{store_url}/products/{product_id}"

# ============================================
# EMAIL SERVICE (RESEND)
# https://resend.com — Sign up and create an API key.
# ============================================
RESEND_API_KEY=""                   # From https://resend.com/api-keys
RESEND_FROM_EMAIL="noreply@your-domain.com"

# ============================================
# ADMIN
# ============================================
# A secret token required to call the admin user creation endpoint.
# Generate one with: openssl rand -hex 24
ADMIN_CREATION_SECRET=""

# ============================================
# FEATURE FLAGS
# ============================================
ENABLE_MERCHANT_REGISTRATION="true"
ENABLE_ORDER_CREATION="true"
ENABLE_TRENDING_ALGORITHM="true"
ENABLE_RISK_SCORING="false"         # Enable fraud risk scoring pipeline

# ============================================
# RISK SCORING & FRAUD DETECTION
# These defaults are tuned for production. Development uses
# high thresholds (999) to effectively disable fraud checks.
# ============================================
# Minimum risk score (0-100) to flag an order as suspicious.
RISK_SCORE_THRESHOLD="70"
# Time window (minutes) for detecting high-frequency orders from one source.
RISK_TRACKING_WINDOW_MINUTES="10"
# Number of orders within the window to trigger a fraud signal.
RISK_TRACKING_ORDER_THRESHOLD="3"

# ============================================
# PLATFORM FETCH (Timeouts & Retries)
# Controls HTTP requests to Salla/Zid APIs.
# ============================================
PLATFORM_FETCH_TIMEOUT_MS="5000"
PLATFORM_FETCH_MAX_RETRIES="1"
PLATFORM_FETCH_RETRY_DELAY_MS="250"
PLATFORM_FETCH_MAX_RETRY_DELAY_MS="30000"

# ============================================
# LOGGING & DEBUG
# Set to "true" to enable. All default to false.
# ============================================
LOG_WEBHOOK_PAYLOADS="false"        # Log full webhook request bodies
RAFF_DEBUG="false"                  # General debug logging
RAFF_SYNC_DEBUG="false"             # Zid product sync debug logs
RAFF_SALLA_SYNC_DEBUG="false"       # Salla product sync debug logs
NEXT_PUBLIC_DEBUG_INTEGRATIONS=""   # Show integration debug info in UI

# ============================================
# DEVELOPMENT ONLY
# Never enable these in production.
# ============================================
# SKIP_WEBHOOK_VERIFICATION="true"  # Bypass webhook signature checks
# SKIP_PLATFORM_SYNC="true"         # Skip product sync on webhook events
