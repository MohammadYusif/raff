{
  "info": {
    "name": "Raff Webhooks (Railway)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "const existingRunId = pm.environment.get(\"run_id\");",
          "if (!existingRunId) { pm.environment.set(\"run_id\", Date.now().toString()); }",
          "const runId = pm.environment.get(\"run_id\");",
          "pm.environment.set(\"zid_order_001\", \"ZID-ORD-001-\" + runId);",
          "pm.environment.set(\"zid_order_002\", \"ZID-ORD-002-\" + runId);",
          "pm.environment.set(\"zid_order_expired\", \"ZID-ORD-EXPIRED-\" + runId);",
          "pm.environment.set(\"zid_order_duplicate\", \"ZID-ORD-DUPLICATE-\" + runId);",
          "pm.environment.set(\"zid_order_invalid\", \"ZID-ORD-INVALID-\" + runId);",
          "pm.environment.set(\"zid_order_multi_1\", \"ZID-ORD-MULTI-\" + runId + \"-1\");",
          "pm.environment.set(\"zid_order_multi_2\", \"ZID-ORD-MULTI-\" + runId + \"-2\");",
          "pm.environment.set(\"zid_order_multi_3\", \"ZID-ORD-MULTI-\" + runId + \"-3\");",
          "pm.environment.set(\"salla_order_001\", \"SALLA-ORD-001-\" + runId);",
          "pm.environment.set(\"salla_order_002\", \"SALLA-ORD-002-\" + runId);",
          "pm.environment.set(\"salla_order_003\", \"SALLA-ORD-003-\" + runId);",
          "pm.environment.set(\"salla_order_expired\", \"SALLA-ORD-EXPIRED-\" + runId);",
          "pm.environment.set(\"salla_order_duplicate\", \"SALLA-ORD-DUPLICATE-\" + runId);"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Zid Webhooks",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const mode = pm.environment.get(\"zid_signature_mode\") || \"plain\";",
              "const secret = pm.environment.get(\"zid_webhook_secret\") || \"\";",
              "const headerName = pm.environment.get(\"zid_header_name\") || \"X-Zid-Webhook-Secret\";",
              "const rawBody = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"\";",
              "const resolvedBody = pm.variables.replaceIn(rawBody);",
              "let signature = \"\";",
              "if (mode === \"plain\") { signature = secret; }",
              "else if (mode === \"sha256\") { signature = CryptoJS.SHA256(secret + resolvedBody).toString(CryptoJS.enc.Hex); }",
              "else if (mode === \"hmac-sha256\") { signature = CryptoJS.HmacSHA256(resolvedBody, secret).toString(CryptoJS.enc.Hex); }",
              "else { throw new Error(\"Unsupported signature mode: \" + mode); }",
              "pm.request.headers.upsert({ key: headerName, value: signature });"
            ]
          }
        }
      ],
      "item": [
        {
          "name": "1. Zid - Product Created",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.create\",\"product_id\":\"{{zid_product_id}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_product_id}}\",\"title\":\"New Test Product\",\"price\":99.99,\"currency\":\"SAR\"}}"
            }
          }
        },
        {
          "name": "2. Zid - Product Updated",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.update\",\"product_id\":\"{{zid_product_id}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_product_id}}\",\"title\":\"Updated Test Product\",\"price\":149.99,\"currency\":\"SAR\"}}"
            }
          }
        },
        {
          "name": "3. Zid - Product Published",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.publish\",\"product_id\":\"{{zid_product_id}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_product_id}}\",\"title\":\"Published Test Product\",\"price\":199.99,\"currency\":\"SAR\"}}"
            }
          }
        },
        {
          "name": "4. Zid - Product Deleted",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.delete\",\"product_id\":\"{{zid_product_id}}\",\"store_id\":\"{{zid_store_id}}\"}"
            }
          }
        },
        {
          "name": "5. Zid - Order Created (No Referrer)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_001}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_001}}\",\"total\":250.0,\"currency\":\"SAR\",\"payment_status\":\"pending\",\"status\":\"pending\",\"created_at\":\"2025-01-01T10:00:00Z\"}}"
            }
          }
        },
        {
          "name": "6. Zid - Order Created (With Referrer -> PENDING)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_002}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_002}}\",\"total\":300.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"pending\",\"status\":\"pending\",\"created_at\":\"2025-01-01T10:05:00Z\"}}"
            }
          }
        },
        {
          "name": "7. Zid - Order Payment Confirmed (PENDING -> APPROVED)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.payment_status.update\",\"order_id\":\"{{zid_order_002}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_002}}\",\"total\":300.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\",\"updated_at\":\"2025-01-01T10:10:00Z\"}}"
            }
          }
        },
        {
          "name": "8. Zid - Order Status Update (Delivered)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.status.update\",\"order_id\":\"{{zid_order_002}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_002}}\",\"total\":300.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"delivered\",\"updated_at\":\"2025-01-01T11:00:00Z\"}}"
            }
          }
        },
        {
          "name": "9. Zid - Order Refunded (APPROVED -> CANCELLED)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.payment_status.update\",\"order_id\":\"{{zid_order_002}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_002}}\",\"total\":300.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"refunded\",\"status\":\"cancelled\",\"updated_at\":\"2025-01-01T12:00:00Z\"}}"
            }
          }
        },
        {
          "name": "10. Zid - Order Created (Expired Referrer)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_expired}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_expired}}\",\"total\":200.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id_expired}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\",\"created_at\":\"2025-01-01T12:15:00Z\"}}"
            }
          }
        },
        {
          "name": "11.1. Zid - Idempotency (Duplicate Order)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_duplicate}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_duplicate}}\",\"total\":100.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\"}}"
            }
          }
        },
        {
          "name": "11.2. Zid - Idempotency (Duplicate Order)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_duplicate}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_duplicate}}\",\"total\":100.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\"}}"
            }
          }
        },
        {
          "name": "12.1. Zid - Multi-order Same Tracking",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_multi_1}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_multi_1}}\",\"total\":120.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\",\"created_at\":\"2025-01-01T12:30:00Z\"}}"
            }
          }
        },
        {
          "name": "12.2. Zid - Multi-order Same Tracking",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_multi_2}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_multi_2}}\",\"total\":120.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\",\"created_at\":\"2025-01-01T12:30:00Z\"}}"
            }
          }
        },
        {
          "name": "12.3. Zid - Multi-order Same Tracking",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_multi_3}}\",\"store_id\":\"{{zid_store_id}}\",\"data\":{\"id\":\"{{zid_order_multi_3}}\",\"total\":120.0,\"currency\":\"SAR\",\"referer_code\":\"{{zid_tracking_id}}\",\"payment_status\":\"paid\",\"status\":\"confirmed\",\"created_at\":\"2025-01-01T12:30:00Z\"}}"
            }
          }
        },
        {
          "name": "13. Zid - Invalid Signature (Should Fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/zid/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.create\",\"order_id\":\"{{zid_order_invalid}}\"}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const headerName = pm.environment.get(\"zid_header_name\") || \"X-Zid-Webhook-Secret\";",
                  "pm.request.headers.upsert({ key: headerName, value: \"invalid\" });"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Salla Webhooks",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const mode = pm.environment.get(\"salla_signature_mode\") || \"sha256\";",
              "const secret = pm.environment.get(\"salla_webhook_secret\") || \"\";",
              "const headerName = pm.environment.get(\"salla_header_name\") || \"X-Salla-Signature\";",
              "const strategyHeader = pm.environment.get(\"salla_security_header\") || \"X-Salla-Security-Strategy\";",
              "const strategyValue = pm.environment.get(\"salla_security_strategy\") || \"Signature\";",
              "const rawBody = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"\";",
              "const resolvedBody = pm.variables.replaceIn(rawBody);",
              "let signature = \"\";",
              "if (mode === \"plain\") { signature = secret; }",
              "else if (mode === \"sha256\") { signature = CryptoJS.SHA256(secret + resolvedBody).toString(CryptoJS.enc.Hex); }",
              "else if (mode === \"hmac-sha256\") { signature = CryptoJS.HmacSHA256(resolvedBody, secret).toString(CryptoJS.enc.Hex); }",
              "else { throw new Error(\"Unsupported signature mode: \" + mode); }",
              "pm.request.headers.upsert({ key: headerName, value: signature });",
              "pm.request.headers.upsert({ key: strategyHeader, value: strategyValue });"
            ]
          }
        }
      ],
      "item": [
        {
          "name": "14. Salla - App Authorization",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"app.store.authorize\",\"merchant\":{\"id\":\"{{salla_store_id}}\",\"name\":\"Test Salla Store\",\"email\":\"test@salla.sa\"},\"data\":{\"access_token\":\"new-test-token-12345\",\"refresh_token\":\"new-refresh-token-67890\",\"expires_in\":31536000}}"
            }
          }
        },
        {
          "name": "15. Salla - Product Created",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_product_id}}\",\"name\":\"New Salla Product\",\"price\":{\"amount\":199.99,\"currency\":\"SAR\"}}}"
            }
          }
        },
        {
          "name": "16. Salla - Product Updated",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.updated\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_product_id}}\",\"name\":\"Updated Salla Product\",\"price\":{\"amount\":249.99,\"currency\":\"SAR\"}}}"
            }
          }
        },
        {
          "name": "17. Salla - Product Published",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.published\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_product_id}}\",\"name\":\"Published Salla Product\",\"price\":{\"amount\":299.99,\"currency\":\"SAR\"}}}"
            }
          }
        },
        {
          "name": "18. Salla - Product Deleted",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"product.deleted\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_product_id}}\"}}"
            }
          }
        },
        {
          "name": "19. Salla - Order Created (No Referrer)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_001}}\",\"total\":{\"amount\":350.0,\"currency\":\"SAR\"},\"payment\":{\"status\":\"pending\"},\"status\":{\"code\":\"pending\"},\"created_at\":\"2025-01-01T13:00:00Z\"}}"
            }
          }
        },
        {
          "name": "20. Salla - Order Created (With Referrer -> PENDING)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_002}}\",\"total\":{\"amount\":400.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"pending\"},\"status\":{\"code\":\"pending\"},\"created_at\":\"2025-01-01T13:05:00Z\"}}"
            }
          }
        },
        {
          "name": "21. Salla - Order Paid (PENDING -> APPROVED)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.paid\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_002}}\",\"total\":{\"amount\":400.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"paid\"},\"status\":{\"code\":\"confirmed\"},\"updated_at\":\"2025-01-01T13:10:00Z\"}}"
            }
          }
        },
        {
          "name": "22. Salla - Order Status Updated (Delivered)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.status.updated\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_002}}\",\"total\":{\"amount\":400.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"paid\"},\"status\":{\"code\":\"delivered\"},\"updated_at\":\"2025-01-01T14:00:00Z\"}}"
            }
          }
        },
        {
          "name": "23. Salla - Order Cancelled (APPROVED -> CANCELLED)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.cancelled\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_002}}\",\"total\":{\"amount\":400.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"refunded\"},\"status\":{\"code\":\"cancelled\"},\"updated_at\":\"2025-01-01T14:30:00Z\"}}"
            }
          }
        },
        {
          "name": "24. Salla - Order Created (Directly Paid -> APPROVED)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_003}}\",\"total\":{\"amount\":550.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"paid\"},\"status\":{\"code\":\"confirmed\"},\"created_at\":\"2025-01-01T14:30:00Z\"}}"
            }
          }
        },
        {
          "name": "25. Salla - Order Created (Expired Referrer)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_expired}}\",\"total\":{\"amount\":220.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id_expired}}\",\"payment\":{\"status\":\"paid\"},\"status\":{\"code\":\"confirmed\"},\"created_at\":\"2025-01-01T14:40:00Z\"}}"
            }
          }
        },
        {
          "name": "26.1. Salla - Idempotency (Duplicate Order)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_duplicate}}\",\"total\":{\"amount\":150.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"paid\"},\"status\":{\"code\":\"confirmed\"}}}"
            }
          }
        },
        {
          "name": "26.2. Salla - Idempotency (Duplicate Order)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_duplicate}}\",\"total\":{\"amount\":150.0,\"currency\":\"SAR\"},\"referrer\":\"{{salla_tracking_id}}\",\"payment\":{\"status\":\"paid\"},\"status\":{\"code\":\"confirmed\"}}}"
            }
          }
        },
        {
          "name": "27. Salla - Invalid Signature (Should Fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/salla/webhook",
            "body": {
              "mode": "raw",
              "raw": "{\"event\":\"order.created\",\"merchant\":{\"id\":\"{{salla_store_id}}\"},\"data\":{\"id\":\"{{salla_order_duplicate}}\"}}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const headerName = pm.environment.get(\"salla_header_name\") || \"X-Salla-Signature\";",
                  "pm.request.headers.upsert({ key: headerName, value: \"invalid\" });"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}
